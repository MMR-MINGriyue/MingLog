# MingLog æ¨¡å—åŒ–æ¶æ„è®¾è®¡æ–‡æ¡£

## ğŸ“‹ æ¦‚è¿°

MingLog å·²æˆåŠŸé‡æ„ä¸ºæ¨¡å—åŒ–çŸ¥è¯†ç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒåŠŸèƒ½æ¨¡å—çš„è‡ªç”±é€‰æ‹©å’Œæ‰©å±•ã€‚æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»äº†æ–°çš„æ¶æ„è®¾è®¡ã€å®ç°æ–¹æ¡ˆå’Œä½¿ç”¨æŒ‡å—ã€‚

## ğŸ—ï¸ æ¶æ„æ¦‚è§ˆ

### æ ¸å¿ƒè®¾è®¡åŸåˆ™

1. **æ¨¡å—åŒ–è§£è€¦**ï¼šåŠŸèƒ½ç‹¬ç«‹ï¼Œæ¥å£æ ‡å‡†åŒ–
2. **æ’ä»¶å‹å¥½**ï¼šæ”¯æŒç¬¬ä¸‰æ–¹æ¨¡å—å¼€å‘
3. **ç”¨æˆ·å¯é€‰**ï¼šåŠŸèƒ½æ¨¡å—å¯è‡ªç”±å¯ç”¨/ç¦ç”¨
4. **å‘åå…¼å®¹**ï¼šå¹³æ»‘è¿ç§»ç°æœ‰æ•°æ®

### ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MingLog åº”ç”¨å±‚                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Desktop App (Tauri)  â”‚  Web App (React)  â”‚  Mobile (Future) â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      æ¨¡å—å±‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ Notes   â”‚ â”‚ MindMap â”‚ â”‚ Tasks   â”‚ â”‚ Search  â”‚ â”‚ Sync    â”‚ â”‚
â”‚  â”‚ Module  â”‚ â”‚ Module  â”‚ â”‚ Module  â”‚ â”‚ Module  â”‚ â”‚ Module  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                      æ ¸å¿ƒå±‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ Module      â”‚ â”‚ Event       â”‚ â”‚ Database    â”‚            â”‚
â”‚  â”‚ Manager     â”‚ â”‚ System      â”‚ â”‚ Manager     â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
minglog/
â”œâ”€â”€ packages/                    # æ¨¡å—åŒ…ç›®å½•
â”‚   â”œâ”€â”€ core/                   # æ ¸å¿ƒåŒ…
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ types/          # ç±»å‹å®šä¹‰
â”‚   â”‚   â”‚   â”œâ”€â”€ module-manager/ # æ¨¡å—ç®¡ç†å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ event-system/   # äº‹ä»¶ç³»ç»Ÿ
â”‚   â”‚   â”‚   â”œâ”€â”€ database/       # æ•°æ®åº“ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ utils/          # å·¥å…·å‡½æ•°
â”‚   â”‚   â”‚   â”œâ”€â”€ MingLogCore.ts  # æ ¸å¿ƒç±»
â”‚   â”‚   â”‚   â””â”€â”€ index.ts        # å¯¼å‡ºæ–‡ä»¶
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”œâ”€â”€ modules/                # åŠŸèƒ½æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ notes/              # ç¬”è®°æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ NotesModule.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ types/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ routes/
â”‚   â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”‚   â”œâ”€â”€ mindmap/            # æ€ç»´å¯¼å›¾æ¨¡å— (å¾…å¼€å‘)
â”‚   â”‚   â”œâ”€â”€ tasks/              # ä»»åŠ¡ç®¡ç†æ¨¡å— (å¾…å¼€å‘)
â”‚   â”‚   â”œâ”€â”€ search/             # æœç´¢æ¨¡å— (å¾…å¼€å‘)
â”‚   â”‚   â””â”€â”€ sync/               # åŒæ­¥æ¨¡å— (å¾…å¼€å‘)
â”‚   â””â”€â”€ ui/                     # å…±äº«UIç»„ä»¶
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â””â”€â”€ components/
â”‚       â””â”€â”€ package.json
â”œâ”€â”€ apps/                       # åº”ç”¨
â”‚   â”œâ”€â”€ tauri-desktop/          # æ¡Œé¢åº”ç”¨
â”‚   â””â”€â”€ web/                    # Webåº”ç”¨
â”œâ”€â”€ pnpm-workspace.yaml         # å·¥ä½œç©ºé—´é…ç½®
â””â”€â”€ package.json                # æ ¹åŒ…é…ç½®
```

## ğŸ”§ æ ¸å¿ƒç»„ä»¶

### 1. æ¨¡å—ç®¡ç†å™¨ (ModuleManager)

è´Ÿè´£æ¨¡å—çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼š

```typescript
class ModuleManager {
  // æ³¨å†Œæ¨¡å—
  async registerModule(id: string, factory: ModuleFactory, config: ModuleConfig): Promise<void>
  
  // æ¿€æ´»æ¨¡å—
  async activateModule(moduleId: string): Promise<void>
  
  // åœç”¨æ¨¡å—
  async deactivateModule(moduleId: string): Promise<void>
  
  // è·å–æ¨¡å—çŠ¶æ€
  getModuleStatus(moduleId: string): ModuleStatus
  
  // è·å–æ¿€æ´»çš„æ¨¡å—
  getActiveModules(): Module[]
}
```

### 2. äº‹ä»¶ç³»ç»Ÿ (EventBus)

æ”¯æŒæ¨¡å—é—´é€šä¿¡ï¼š

```typescript
class EventBus {
  // å‘é€äº‹ä»¶
  emit(type: string, data?: any, source?: string, target?: string): void
  
  // ç›‘å¬äº‹ä»¶
  on(type: string, handler: (event: ModuleEvent) => void): void
  
  // å–æ¶ˆç›‘å¬
  off(type: string, handler: (event: ModuleEvent) => void): void
  
  // ç­‰å¾…äº‹ä»¶
  waitFor(type: string, timeout?: number): Promise<ModuleEvent>
}
```

### 3. æ•°æ®åº“ç®¡ç†å™¨ (DatabaseManager)

æä¾›æ¨¡å—åŒ–æ•°æ®åº“è®¿é—®ï¼š

```typescript
class DatabaseManager {
  // æ³¨å†Œæ¨¡å—æ•°æ®åº“æ¨¡å¼
  registerSchema(moduleId: string, schema: DatabaseSchema): void
  
  // æ‰§è¡ŒæŸ¥è¯¢
  async query<T>(sql: string, params?: any[]): Promise<T[]>
  
  // æ‰§è¡Œäº‹åŠ¡
  async transaction<T>(callback: () => Promise<T>): Promise<T>
  
  // åˆ›å»ºè¡¨
  async createTable(tableName: string, schema: TableSchema): Promise<void>
}
```

## ğŸ§© æ¨¡å—æ¥å£

### æ ‡å‡†æ¨¡å—æ¥å£

æ¯ä¸ªæ¨¡å—å¿…é¡»å®ç°ä»¥ä¸‹æ¥å£ï¼š

```typescript
interface Module {
  // åŸºæœ¬ä¿¡æ¯
  readonly id: string
  readonly name: string
  readonly version: string
  readonly description: string
  readonly dependencies: string[]
  
  // ç”Ÿå‘½å‘¨æœŸæ–¹æ³•
  initialize(core: CoreAPI): Promise<void>
  activate(): Promise<void>
  deactivate(): Promise<void>
  
  // åŠŸèƒ½æä¾›
  getRoutes?(): ModuleRoute[]
  getMenuItems?(): ModuleMenuItem[]
  getSettings?(): SettingItem[]
  
  // äº‹ä»¶å¤„ç†
  onEvent?(event: ModuleEvent): void
}
```

### æ¨¡å—é…ç½®

```typescript
interface ModuleConfig {
  id: string
  name: string
  description: string
  version: string
  enabled: boolean
  dependencies: string[]
  settings: Record<string, any>
}
```

## ğŸ“ ç¤ºä¾‹ï¼šç¬”è®°æ¨¡å—

### æ¨¡å—å®ç°

```typescript
export class NotesModule implements Module {
  readonly id = 'notes'
  readonly name = 'ç¬”è®°ç®¡ç†'
  readonly version = '1.0.0'
  readonly description = 'æä¾›ç¬”è®°çš„åˆ›å»ºã€ç¼–è¾‘ã€æ ‡ç­¾ç®¡ç†ç­‰åŠŸèƒ½'
  readonly dependencies: string[] = []

  async initialize(core: CoreAPI): Promise<void> {
    // åˆ›å»ºæ•°æ®åº“è¡¨
    await core.database.execute(`
      CREATE TABLE IF NOT EXISTS notes (
        id TEXT PRIMARY KEY,
        title TEXT NOT NULL,
        content TEXT NOT NULL DEFAULT '',
        tags TEXT DEFAULT '[]',
        is_favorite BOOLEAN DEFAULT FALSE,
        is_archived BOOLEAN DEFAULT FALSE,
        created_at TEXT NOT NULL,
        updated_at TEXT NOT NULL
      )
    `)
  }

  async activate(): Promise<void> {
    // æ³¨å†Œäº‹ä»¶ç›‘å¬å™¨
    this.coreAPI.events.on('search:query', this.handleSearchQuery.bind(this))
  }

  async deactivate(): Promise<void> {
    // æ¸…ç†èµ„æº
    this.coreAPI.events.off('search:query', this.handleSearchQuery.bind(this))
  }

  getRoutes(): ModuleRoute[] {
    return [
      {
        path: '/notes',
        component: NotesListPage,
        title: 'ç¬”è®°åˆ—è¡¨'
      },
      {
        path: '/notes/new',
        component: NoteEditorPage,
        title: 'æ–°å»ºç¬”è®°'
      }
    ]
  }

  getMenuItems(): ModuleMenuItem[] {
    return [
      {
        id: 'notes',
        label: 'ç¬”è®°',
        icon: 'FileText',
        path: '/notes',
        order: 1
      }
    ]
  }
}
```

### æœåŠ¡å±‚

```typescript
export class NotesService {
  constructor(private coreAPI: CoreAPI) {}

  async createNote(request: CreateNoteRequest): Promise<Note> {
    const note = {
      id: uuidv4(),
      title: request.title,
      content: request.content || '',
      tags: request.tags || [],
      is_favorite: false,
      is_archived: false,
      created_at: new Date().toISOString(),
      updated_at: new Date().toISOString()
    }

    await this.coreAPI.database.execute(
      'INSERT INTO notes (...) VALUES (...)',
      [/* parameters */]
    )

    // å‘é€åˆ›å»ºäº‹ä»¶
    this.coreAPI.events.emit('data:created', {
      type: 'note',
      id: note.id,
      data: note
    })

    return note
  }
}
```

## ğŸš€ ä½¿ç”¨æŒ‡å—

### 1. åˆå§‹åŒ–æ ¸å¿ƒç³»ç»Ÿ

```typescript
import { MingLogCore } from '@minglog/core'
import { NotesModuleFactory } from '@minglog/notes'

// åˆ›å»ºæ ¸å¿ƒå®ä¾‹
const core = new MingLogCore({
  database: databaseConnection,
  debugMode: true
})

// åˆå§‹åŒ–
await core.initialize()

// æ³¨å†Œæ¨¡å—
await core.registerModule('notes', NotesModuleFactory, {
  id: 'notes',
  name: 'ç¬”è®°ç®¡ç†',
  version: '1.0.0',
  description: 'ç¬”è®°åŠŸèƒ½æ¨¡å—',
  enabled: true,
  dependencies: [],
  settings: {}
})

// æ¿€æ´»æ¨¡å—
await core.activateModule('notes')
```

### 2. å¼€å‘æ–°æ¨¡å—

1. **åˆ›å»ºæ¨¡å—ç›®å½•**ï¼š
   ```bash
   mkdir packages/modules/my-module
   cd packages/modules/my-module
   ```

2. **å®ç°æ¨¡å—ç±»**ï¼š
   ```typescript
   export class MyModule implements Module {
     readonly id = 'my-module'
     readonly name = 'æˆ‘çš„æ¨¡å—'
     // ... å®ç°æ¥å£æ–¹æ³•
   }
   ```

3. **æ³¨å†Œå’Œæ¿€æ´»**ï¼š
   ```typescript
   await core.registerModule('my-module', MyModuleFactory, config)
   await core.activateModule('my-module')
   ```

### 3. æ¨¡å—é—´é€šä¿¡

```typescript
// å‘é€äº‹ä»¶
core.getEventBus().emit('my-event', { data: 'hello' }, 'my-module')

// ç›‘å¬äº‹ä»¶
core.getEventBus().on('other-event', (event) => {
  console.log('Received:', event.data)
})
```

## ğŸ”„ æ•°æ®è¿ç§»

### ä»å•ä½“æ¶æ„è¿ç§»

1. **æ•°æ®å¤‡ä»½**ï¼š
   ```typescript
   await core.getDatabaseManager().backup('./backup.db')
   ```

2. **æ¨¡å¼è¿ç§»**ï¼š
   - ç°æœ‰æ•°æ®è¡¨ä¿æŒä¸å˜
   - æ–°å¢æ¨¡å—é…ç½®è¡¨
   - æ¸è¿›å¼è¿ç§»æ•°æ®

3. **åŠŸèƒ½è¿ç§»**ï¼š
   - å°†ç°æœ‰åŠŸèƒ½é€æ­¥é‡æ„ä¸ºæ¨¡å—
   - ä¿æŒAPIå…¼å®¹æ€§
   - åˆ†é˜¶æ®µåˆ‡æ¢

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### 1. æ‡’åŠ è½½

- æ¨¡å—æŒ‰éœ€åŠ è½½
- ç»„ä»¶æ‡’åŠ è½½
- è·¯ç”±ä»£ç åˆ†å‰²

### 2. äº‹ä»¶ä¼˜åŒ–

- äº‹ä»¶é˜²æŠ–å’ŒèŠ‚æµ
- äº‹ä»¶å†å²é™åˆ¶
- å†…å­˜æ³„æ¼é˜²æŠ¤

### 3. æ•°æ®åº“ä¼˜åŒ–

- ç´¢å¼•ä¼˜åŒ–
- æŸ¥è¯¢ç¼“å­˜
- è¿æ¥æ± ç®¡ç†

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### 1. å•å…ƒæµ‹è¯•

```typescript
describe('NotesModule', () => {
  it('should create note', async () => {
    const module = new NotesModule(config)
    await module.initialize(mockCoreAPI)
    
    const service = module.getNotesService()
    const note = await service.createNote({
      title: 'Test Note',
      content: 'Test content'
    })
    
    expect(note.title).toBe('Test Note')
  })
})
```

### 2. é›†æˆæµ‹è¯•

```typescript
describe('Module Integration', () => {
  it('should communicate between modules', async () => {
    const core = new MingLogCore(options)
    await core.initialize()
    
    await core.activateModule('notes')
    await core.activateModule('search')
    
    // æµ‹è¯•æ¨¡å—é—´é€šä¿¡
    core.getEventBus().emit('search:query', { query: 'test' })
    
    const results = await core.getEventBus().waitFor('search:results')
    expect(results.data.results).toBeDefined()
  })
})
```

## ğŸ”® æœªæ¥è§„åˆ’

### Phase 2: åŸºç¡€æ¨¡å—å®ç° (Week 3-4)
- [ ] æ¨¡å—ç®¡ç†UIç•Œé¢
- [ ] æ¨¡å—é…ç½®ç³»ç»Ÿ
- [ ] ç¬”è®°æ¨¡å—å®Œå–„

### Phase 3: æ‰©å±•æ¨¡å—å¼€å‘ (Week 5-6)
- [ ] æ€ç»´å¯¼å›¾æ¨¡å—
- [ ] ä»»åŠ¡ç®¡ç†æ¨¡å—
- [ ] æœç´¢æ¨¡å—é‡æ„

### Phase 4: é«˜çº§åŠŸèƒ½ (Week 7-8)
- [ ] æ¨¡å—çƒ­æ’æ‹”
- [ ] ç¬¬ä¸‰æ–¹æ¨¡å—API
- [ ] æ€§èƒ½ä¼˜åŒ–

## ğŸ“š å‚è€ƒèµ„æ–™

- [æ¨¡å—å¼€å‘æŒ‡å—](./module-development-guide.md)
- [APIæ–‡æ¡£](./api-reference.md)
- [æœ€ä½³å®è·µ](./best-practices.md)
- [æ•…éšœæ’é™¤](./troubleshooting.md)

---

**æ³¨æ„**ï¼šè¿™æ˜¯ä¸€ä¸ªæ´»è·ƒçš„å¼€å‘é¡¹ç›®ï¼Œæ¶æ„å’ŒAPIå¯èƒ½ä¼šæ ¹æ®éœ€æ±‚è¿›è¡Œè°ƒæ•´ã€‚è¯·å…³æ³¨æ›´æ–°æ—¥å¿—è·å–æœ€æ–°ä¿¡æ¯ã€‚
