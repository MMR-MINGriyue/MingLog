#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# MingLog Pre-commit Hook
# åœ¨æäº¤å‰æ‰§è¡Œä»£ç è´¨é‡æ£€æŸ¥

echo "ğŸ” æ‰§è¡Œ pre-commit æ£€æŸ¥..."

# 1. è¿è¡Œ lint æ£€æŸ¥
echo "ğŸ“ æ£€æŸ¥ä»£ç è§„èŒƒ..."
npm run lint:check
if [ $? -ne 0 ]; then
  echo "âŒ ESLint æ£€æŸ¥å¤±è´¥ï¼Œè¯·ä¿®å¤ä»£ç è§„èŒƒé—®é¢˜"
  exit 1
fi

# 2. è¿è¡Œæ ¼å¼æ£€æŸ¥
echo "ğŸ¨ æ£€æŸ¥ä»£ç æ ¼å¼..."
npm run format:check
if [ $? -ne 0 ]; then
  echo "âŒ Prettier æ ¼å¼æ£€æŸ¥å¤±è´¥ï¼Œè¯·è¿è¡Œ npm run format ä¿®å¤æ ¼å¼"
  exit 1
fi

# 3. è¿è¡Œç±»å‹æ£€æŸ¥
echo "ğŸ”§ æ£€æŸ¥ TypeScript ç±»å‹..."
npm run type-check
if [ $? -ne 0 ]; then
  echo "âŒ TypeScript ç±»å‹æ£€æŸ¥å¤±è´¥ï¼Œè¯·ä¿®å¤ç±»å‹é”™è¯¯"
  exit 1
fi

# 4. è¿è¡Œå•å…ƒæµ‹è¯•
echo "ğŸ§ª è¿è¡Œå•å…ƒæµ‹è¯•..."
npm run test:unit
if [ $? -ne 0 ]; then
  echo "âŒ å•å…ƒæµ‹è¯•å¤±è´¥ï¼Œè¯·ä¿®å¤æµ‹è¯•é—®é¢˜"
  exit 1
fi

echo "âœ… Pre-commit æ£€æŸ¥é€šè¿‡ï¼"
